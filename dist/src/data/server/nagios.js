"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}}(),_axios=require("axios"),_axios2=_interopRequireDefault(_axios),_path=require("path"),_path2=_interopRequireDefault(_path),_database=require("./database"),_database2=_interopRequireDefault(_database);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var auth=require("../../json/nagios.json"),Nagios=function(){function t(e){return _classCallCheck(this,t),this.instance||(this.instance=this),this.server=e,this.database=new _database2.default,this.instance}return _createClass(t,[{key:"fetchNagiosData",value:function(e,t){var r=this;return new Promise(function(a,n){try{return _axios2.default.get(r.server+"/nagios/cgi-bin/statusjson.cgi?query=service&hostname="+e+"&servicedescription="+t,{auth:auth}).then(function(e,t){void 0!==e.data.data.service?a(e.data.data.service.plugin_output):n("Could not fetch nagios data")})}catch(e){n(e)}})}},{key:"getNetworkThroughput",value:function(t){return this.database.getDatabase().then(function(e){return e.get("SELECT * FROM servers WHERE (id = ?)",t).then(function(e){return fetchNagiosData(e.nagios,"Network+Throughput").then(function(e){var t=e.split(" ");return{in:Number(t[4]),out:Number(t[2])}}).catch(function(e){return console.log(e)})})})}},{key:"getCpuLoad",value:function(t){return this.database.getDatabase().then(function(e){return e.get("SELECT * FROM servers WHERE (id = ?)",t).then(function(e){return fetchNagiosData(e.nagios,"CPU+Load").then(function(e){var t=e.replace(/,/g,"");return t=t.split(" "),{one:Number(t[4]),five:Number(t[5]),fifteen:Number(t[6])}}).catch(function(e){return console.log(e)})})})}},{key:"getMemoryLoad",value:function(t){return this.database.getDatabase().then(function(e){return e.get("SELECT * FROM servers WHERE (id = ?)",t).then(function(e){return fetchNagiosData(e.nagios,"Memory").then(function(e){var t=e.replace(/%/g,"");return t=t.split(" "),Number(t[3]/100)}).catch(function(e){return console.log(e)})})})}}]),t}();Nagios.instance=null,exports.default=Nagios;